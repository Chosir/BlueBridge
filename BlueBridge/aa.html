package&nbsp;com.teachMng.onlineTeach.action;
<br>
<br>import&nbsp;java.io.IOException;
<br>import&nbsp;java.io.PrintWriter;
<br>import&nbsp;java.util.HashSet;
<br>import&nbsp;java.util.Set;
<br>
<br>import&nbsp;javax.annotation.Resource;
<br>import&nbsp;javax.servlet.http.HttpServletResponse;
<br>
<br>import&nbsp;org.apache.struts2.interceptor.ServletResponseAware;
<br>import&nbsp;org.springframework.stereotype.Component;
<br>
<br>import&nbsp;com.opensymphony.xwork2.ActionSupport;
<br>import&nbsp;com.teachMng.onlineTeach.dto.InfoTagItem;
<br>import&nbsp;com.teachMng.onlineTeach.service.RunnableAutoPlanTask;
<br>
<br>@SuppressWarnings(&quot;serial&quot;)
<br>@Component(&quot;autoPlanAction&quot;)
<br>public&nbsp;<b>class</b>&nbsp;AutoPlanAction&nbsp;extends&nbsp;ActionSupport&nbsp;implements&nbsp;ServletResponseAware{
<br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>private</b>&nbsp;HttpServletResponse&nbsp;response;
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>private</b>&nbsp;String&nbsp;typeName;
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>private</b>&nbsp;String&nbsp;selectName;
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;<b>void</b>&nbsp;setSelectName(String&nbsp;selectName)&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.selectName&nbsp;=&nbsp;selectName;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;String&nbsp;getSelectName()&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b>&nbsp;selectName;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;String&nbsp;getTypeName()&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b>&nbsp;typeName;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;<b>void</b>&nbsp;setTypeName(String&nbsp;typeName)&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.typeName&nbsp;=&nbsp;typeName;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>private</b>&nbsp;Set&lt;InfoTagItem&gt;&nbsp;infoTag&nbsp;=&nbsp;<b>new</b>&nbsp;HashSet&lt;InfoTagItem&gt;();
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;Set&lt;InfoTagItem&gt;&nbsp;getInfoTag()&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b>&nbsp;infoTag;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;<b>void</b>&nbsp;setInfoTag(Set&lt;InfoTagItem&gt;&nbsp;infoTag)&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.infoTag&nbsp;=&nbsp;infoTag;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;/**
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;定义一个线程引用，保存排课线程
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
<br>&nbsp;&nbsp;&nbsp;&nbsp;Thread&nbsp;apt;
<br>&nbsp;&nbsp;&nbsp;&nbsp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;/**
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;排课线程运行对象引用
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
<br>&nbsp;&nbsp;&nbsp;&nbsp;@Resource(name&nbsp;=&nbsp;&quot;runnableAutoPlanTask&quot;)
<br>&nbsp;&nbsp;&nbsp;&nbsp;RunnableAutoPlanTask&nbsp;task;
<br>&nbsp;&nbsp;&nbsp;&nbsp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;<b>void</b>&nbsp;start(){
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;onProgress&nbsp;=&nbsp;task.getAp().onProgress;
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!onProgress){
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;task.init();
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread&nbsp;taskThread&nbsp;=&nbsp;<b>new</b>&nbsp;Thread(task);
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskThread.start();
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out().print(&quot;start&quot;);
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out().close();
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out().print(&quot;onProgress&quot;);
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;String&nbsp;getSName()&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out().print(task.getSelectList(getTypeName()));
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b>&nbsp;null;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;String&nbsp;generateCoursePlan()&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out().print(task.getInfoTag());
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b>&nbsp;null;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;String&nbsp;getCoursePlan()&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out().print(task.getCoursePlanBysName(typeName,&nbsp;selectName));
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b>&nbsp;null;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;String&nbsp;cancel(){
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apt.interrupt();
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b>&nbsp;SUCCESS;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;/**
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;返回处理百分比
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;<b>void</b>&nbsp;printProgressPercent(){
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out().print(&nbsp;task.progressedPercent()&nbsp;*&nbsp;100);
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;/**
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;返回消息
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;<b>void</b>&nbsp;msg(){
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out().print(task.pollMsg());
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;@Override
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;<b>void</b>&nbsp;setServletResponse(HttpServletResponse&nbsp;resp)&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response&nbsp;=&nbsp;resp;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;String&nbsp;giveMeSuccess(){
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b>&nbsp;SUCCESS;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;
<br><font color=green>//&nbsp;&nbsp;&nbsp;&nbsp;getters&nbsp;and&nbsp;setters</font>
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;RunnableAutoPlanTask&nbsp;getTask()&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b>&nbsp;task;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;<b>void</b>&nbsp;setTask(RunnableAutoPlanTask&nbsp;task)&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.task&nbsp;=&nbsp;task;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>
<br><font color=green>//&nbsp;&nbsp;&nbsp;&nbsp;util</font>
<br>&nbsp;&nbsp;&nbsp;&nbsp;<b>public</b>&nbsp;PrintWriter&nbsp;out(){
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.setCharacterEncoding(&quot;utf-8&quot;);
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b>&nbsp;response.getWriter();
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;e)&nbsp;{
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.err.println(&quot;系统错误，获取response对象失败！&quot;);
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b>&nbsp;null;
<br>&nbsp;&nbsp;&nbsp;&nbsp;}
<br>
<br>}
<br>
